#[cfg(test)]
mod tests {
    use std::fs;

    use bytes::Bytes;

    use crate::fixtures::installer_fixtures::{installer_fixture, setup_dirs};

    #[test]
    fn install() {
        let test_dir = setup_dirs();
        let mut installer = installer_fixture();
        let bytes = Bytes::from(&b"PK\x03\x04\n\0\0\0\0\0\xb2\x866>\0\0\0\0\0\0\0\0\0\0\0\0\x07\0\0\0Munkey/PK\x03\x04\n\0\0\0\0\0\xfc{\\>\0\0\0\0\0\0\0\0\0\0\0\0\n\0\0\0Munkey/Ah/PK\x03\x04\x14\0\0\0\x08\0\xfcjb>\x1fM\xcfn*\x04\0\0-\x0c\0\0\x12\0\0\0Munkey/Ah/Main.lua\xadV\xdbn\xdb8\x10}v\x80\xfc\xc3@]\xa3R*+\x96\x81\x02\xbb\xbe\x04H\xd2d\xfbPl\n8@\x1f\x02\xa7\xa0%\xda\x12*Q\x02I\xad\x13\x14\xed\xb7\xef\x0cu\xb1\xd4\xc8MZ\xec\x8bDQg\xce\x9c\x19\x0e\x87\x8c\xd3<\x93\x1a\xac\xdbB\xaec\xc1\xad\xe3\xa3\xe3\xa3\xf3\xe82\ra\x01\xd5\x9c\xb7\x8cx\x92\\fi\xcaDh;3\x82l\n\x11\xe88\x13`\xb0\xd3\xab\x07\x1e\x14\x9a\xdbA\x1a\xba\xc0\xe4V9\xc7G\x83\x7fY\xe2\xbb\x90\xe5\xd2\x05\x1cN\x90\x90\xfeLS\xa6\x83\xc8\xb6\xee\xed\xbb\xe1hh\x0f\xd5\xea\xe4n\x18\x0e=w\xe8\xac\xde\x0c\xd5\x89c\xdf\xdd\x0fwC\xe5\xb9+\xa7\x0f\xe2\x9d8\x7fX\xce\x0cF\xa3\xdb\x9bw7S\xd8\xc4\"\x04\x06k\xae5\x97\xb0c\x8f\xa03\x083\xd0Q\xacPD\xbc\x01\x9b\x84\xc0\xf7\x05\x888\x01\x0c\xa1T\xd3\xfaF\x89\xd5\xa7\x83f\\ 7\\F<\xf8\xa2\0\xcdc\xfdZ!\x0c\xf8C.\xb9R\x184\xd2\x0e\xca\xb8\xf1\xc9\x92\x92\xdf\xf3\x0c\x0f\xbe\x88\xde\x08\x84+\x1c\x16L\xf3\xae-O\x14'\n\xca\x06&E\xe5I\xacm\xfap\xc1\x8224X\xd2\xa4\"5\x94\xb4\"\xe5B\x83\xd22\x16[`\xdaL\xab\x9c\x05\x86\x86\"$\xeb;\x7fe\xa21\xe3\xc9\xea'\x11\x19\x8f\x90\xcb,,\x02\x1e\x82\xdee\xa4\xb9\xe0\x94\xaf\xc1\x80\xa0Y\x9a3\x14\\\xbbL\xb8\xd8\xea\xa8d\xcad\xc8eW\x19\xe2H\x1f\xe6\xbd.\x0bCD\xc2J\x02\x0f\tl\\\xf7\xc8\xdb$Y&k\xb9\x8e\x03\x8b\x05\xfc\x042AH\x19\x80!\xec\x84:\xaf\x03m\x03(\xa7~Uh\xf8k\xb6\x9f\xad\xcb\x0fM\xabYZ\x866\xe1\xd9\xe2YF\xbf\x97\xb1\xf1\xc3Eh\x065\xf3s\xc1\xcf\x7f%\xf6\xde\xc8\xfa\x02{\xa9\xf7\xb3\xdf\xf5\xee\xf7y\xaf%U9\xa8k\xbc\xd7\xb0\xc7\xae2#\xdd\xfa1\xe7\xb6\xceD\x91\xae\xb9Q\xe3\x97ub\x953\x16\x98*\x87\x92\xa4\xbf\xc6\x8dS\xe21P$5\xe0X\x11\xd8(\xa8vo\x11|\x94q\xe9bV\xab~\x91\x04\xa2}\x02\x9atA\xfd\xaa\xc8rblU\xbf\x12\xd3?'{=\x86 +\x92P\xbc\xd6\x90\xb2/\x9c6\x1bNg\x1b\xb3\x07c\x91\x17\xba\xc5\xf47\xd7\xefy\x92\xdbN+\xad\xe6i\x1eO\x1aw\xe5x]<f\x85va\x1d\x87\xd4\xb9\xcb\xcf\xcf\x01.R\xab0*\xd4\xe9\xd8\xfb\xeb\xadsb\xfb\xe3{\x8c\xf8\xb4|\xcf\xaaV\x8b\x04\x9dE!\x11\x9dc\xc4\xfb$c\xcd?\xe0\xb7\r\xd6\\n\xd7\x8bW\xe3\xf1\xf5\xf5x|\xb6\xe4\x1a.\x8c\x07\xec$\xf3S\xfcu\x06%\xe0\xfa\xda\0,j\xae\x8d4\x1c[\xaa\x03\xabx\xb0\rm\xb9\xee\xfc\xf9s\xfc#A\xdb\xdc\x02#\xbf.\xd9_\x90\xbb\xd4Ljj\x90\x17\x18\xf6\x13\xd1\x17\x8d\xcfN\x12\xe3\xb07\x83mE\x1dG\xa6d\xfe\xbf\xc4\xd0I\xb9\xe3\\\x1cN\x10\xc6r\x90\x03\xb5\xfcFf\x0f\xd7_S\xae\x08;\x9c\xf8\xe5\xa3\xd0\xeca\n\xa7,\x82y.\xe3\x80\xd7\xd4\x87m\xf0`\x0e\xa0c\xb8?\x84+k#\xe9\xa9\xa0e\x847\xa2F\x95\xe4\xba\x90\x02\xac\xf3\xf7\xf5\"\x10s\x910\x9dI\xeb\xe0\xb62\xf7\x02rH\x14\x1cOW\xdcJI\xc6\xc2\xb2\xe5\xdaV\xcdJ\xd920\xbb\xd9B\x06\xfd\xfd\x85{\xa8[\x93\r\x9dY\x84\xber\\\x1c\\=\xe3vofu\xf6DOo\xe9]\xd4\xf2.\x93/M\x94.\xe4\x1f\x19\xdd\xca\x04%!\xc9\x02tp\xcb\xd6\t\xc7\\|\xfdF}\xed\x9f\x9b\xdb\xab)\x14\xd8\xcd\xbe\n\x9c\x1c\x7f\xc3v\x06\x1f\n6z\xeb\x8d\x1b\x93M\x8e7\x1el\xab\xb67r\x8c\xd2\x9a\xb5A$L\xe9\xcf(\x05Q~3\x89\xb7)\xeeB\xc0r\x9c\xad\x04M\xe9\xaeh\x13\x9f\x0b>i\xdaE1\xaaQx]\xac\x0e\x1fE\x89\xf7\xf1\x8ec\x0cqlY\xfbCP\x93v/\xc6\xe6+\xb5m\x02q\x11\xe5\xb4\x8e\xaf\x96\x10\xfe\x86\xa4\x0c\x9eQQ\x1b8uBID\xc32_\xc0\xab\xca\xa8Q\xd1\xa5R\xc5\xdans\xf4i\x84Jd\xc9_\x15\x9e\xf9\xd5\xac_\xb7\xba\xce\xc3\xb0\xbe\xec\x83\xc5\"\xcb-\x8b\x1a\xb7\xcc\x7fPK\x03\x04\x14\0\0\0\x08\0\xd3\xa8d>H>X{|\0\0\0\xb7\0\0\0\x10\0\0\0Munkey/Ah.plugin\xb3\xb1\xaf\xc8\xcdQ(K-*\xce\xcc\xcf\xb3U2\xd43P\xb2\xb7\xe3\xe5\xb2\t\xc8)M\xcf\xcc\x03\xb28m<\xf3\xd2\xf2\x8br\x13K\x80\n@|N\x1b\xbf\xc4\xdcT;\xc7\x0c\x1b}0\x03,\xe4XZ\x92\x91_d\xe7[\x9a\x97\x9dZi\xa3\x0f\xe5\x82\xa5\xc2 f\xdb\x19\xe8\x99\xda\xe8\xc38 s\xf5\xd1\x0c\xb6\tHL\xceNLO\x85\x9a\xa2\xe7\x98\xa1\xe7\x9b\x98\x99g\xa3\x0f\x13\x07:K\x1f\xea.\0PK\x01\x02\x14\0\n\0\0\0\0\0\xb2\x866>\0\0\0\0\0\0\0\0\0\0\0\0\x07\0\0\0\0\0\0\0\0\0\x10\0\0\0\0\0\0\0Munkey/PK\x01\x02\x14\0\n\0\0\0\0\0\xfc{\\>\0\0\0\0\0\0\0\0\0\0\0\0\n\0\0\0\0\0\0\0\0\0\x10\0\0\0%\0\0\0Munkey/Ah/PK\x01\x02\x14\0\x14\0\0\0\x08\0\xfcjb>\x1fM\xcfn*\x04\0\0-\x0c\0\0\x12\0\0\0\0\0\0\0\x01\0 \0\0\0M\0\0\0Munkey/Ah/Main.luaPK\x01\x02\x14\0\x14\0\0\0\x08\0\xd3\xa8d>H>X{|\0\0\0\xb7\0\0\0\x10\0\0\0\0\0\0\0\x01\0 \0\0\0\xa7\x04\0\0Munkey/Ah.pluginPK\x05\x06\0\0\0\0\x04\0\x04\0\xeb\0\0\0Q\x05\0\0\0\0"[..]);

        installer.install(&bytes).unwrap();

        let directory = fs::read_dir(installer.tmp_file_path).unwrap();

        let result = directory
            .into_iter()
            .map(|file| file.unwrap().file_name().to_str().unwrap().to_string())
            .collect::<Vec<String>>();

        assert_eq!(result, vec!["Munkey", "plugin.zip"]);

        fs::remove_dir_all(test_dir).expect("Error while running test teardown");
    }

    #[test]
    fn delete() {
        let test_dir = setup_dirs();
        let mut installer = installer_fixture();
        let bytes = Bytes::from(&b"PK\x03\x04\n\0\0\0\0\0\xb2\x866>\0\0\0\0\0\0\0\0\0\0\0\0\x07\0\0\0Munkey/PK\x03\x04\n\0\0\0\0\0\xfc{\\>\0\0\0\0\0\0\0\0\0\0\0\0\n\0\0\0Munkey/Ah/PK\x03\x04\x14\0\0\0\x08\0\xfcjb>\x1fM\xcfn*\x04\0\0-\x0c\0\0\x12\0\0\0Munkey/Ah/Main.lua\xadV\xdbn\xdb8\x10}v\x80\xfc\xc3@]\xa3R*+\x96\x81\x02\xbb\xbe\x04H\xd2d\xfbPl\n8@\x1f\x02\xa7\xa0%\xda\x12*Q\x02I\xad\x13\x14\xed\xb7\xef\x0cu\xb1\xd4\xc8MZ\xec\x8bDQg\xce\x9c\x19\x0e\x87\x8c\xd3<\x93\x1a\xac\xdbB\xaec\xc1\xad\xe3\xa3\xe3\xa3\xf3\xe82\ra\x01\xd5\x9c\xb7\x8cx\x92\\fi\xcaDh;3\x82l\n\x11\xe88\x13`\xb0\xd3\xab\x07\x1e\x14\x9a\xdbA\x1a\xba\xc0\xe4V9\xc7G\x83\x7fY\xe2\xbb\x90\xe5\xd2\x05\x1cN\x90\x90\xfeLS\xa6\x83\xc8\xb6\xee\xed\xbb\xe1hh\x0f\xd5\xea\xe4n\x18\x0e=w\xe8\xac\xde\x0c\xd5\x89c\xdf\xdd\x0fwC\xe5\xb9+\xa7\x0f\xe2\x9d8\x7fX\xce\x0cF\xa3\xdb\x9bw7S\xd8\xc4\"\x04\x06k\xae5\x97\xb0c\x8f\xa03\x083\xd0Q\xacPD\xbc\x01\x9b\x84\xc0\xf7\x05\x888\x01\x0c\xa1T\xd3\xfaF\x89\xd5\xa7\x83f\\ 7\\F<\xf8\xa2\0\xcdc\xfdZ!\x0c\xf8C.\xb9R\x184\xd2\x0e\xca\xb8\xf1\xc9\x92\x92\xdf\xf3\x0c\x0f\xbe\x88\xde\x08\x84+\x1c\x16L\xf3\xae-O\x14'\n\xca\x06&E\xe5I\xacm\xfap\xc1\x8224X\xd2\xa4\"5\x94\xb4\"\xe5B\x83\xd22\x16[`\xdaL\xab\x9c\x05\x86\x86\"$\xeb;\x7fe\xa21\xe3\xc9\xea'\x11\x19\x8f\x90\xcb,,\x02\x1e\x82\xdee\xa4\xb9\xe0\x94\xaf\xc1\x80\xa0Y\x9a3\x14\\\xbbL\xb8\xd8\xea\xa8d\xcad\xc8eW\x19\xe2H\x1f\xe6\xbd.\x0bCD\xc2J\x02\x0f\tl\\\xf7\xc8\xdb$Y&k\xb9\x8e\x03\x8b\x05\xfc\x042AH\x19\x80!\xec\x84:\xaf\x03m\x03(\xa7~Uh\xf8k\xb6\x9f\xad\xcb\x0fM\xabYZ\x866\xe1\xd9\xe2YF\xbf\x97\xb1\xf1\xc3Eh\x065\xf3s\xc1\xcf\x7f%\xf6\xde\xc8\xfa\x02{\xa9\xf7\xb3\xdf\xf5\xee\xf7y\xaf%U9\xa8k\xbc\xd7\xb0\xc7\xae2#\xdd\xfa1\xe7\xb6\xceD\x91\xae\xb9Q\xe3\x97ub\x953\x16\x98*\x87\x92\xa4\xbf\xc6\x8dS\xe21P$5\xe0X\x11\xd8(\xa8vo\x11|\x94q\xe9bV\xab~\x91\x04\xa2}\x02\x9atA\xfd\xaa\xc8rblU\xbf\x12\xd3?'{=\x86 +\x92P\xbc\xd6\x90\xb2/\x9c6\x1bNg\x1b\xb3\x07c\x91\x17\xba\xc5\xf47\xd7\xefy\x92\xdbN+\xad\xe6i\x1eO\x1aw\xe5x]<f\x85va\x1d\x87\xd4\xb9\xcb\xcf\xcf\x01.R\xab0*\xd4\xe9\xd8\xfb\xeb\xadsb\xfb\xe3{\x8c\xf8\xb4|\xcf\xaaV\x8b\x04\x9dE!\x11\x9dc\xc4\xfb$c\xcd?\xe0\xb7\r\xd6\\n\xd7\x8bW\xe3\xf1\xf5\xf5x|\xb6\xe4\x1a.\x8c\x07\xec$\xf3S\xfcu\x06%\xe0\xfa\xda\0,j\xae\x8d4\x1c[\xaa\x03\xabx\xb0\rm\xb9\xee\xfc\xf9s\xfc#A\xdb\xdc\x02#\xbf.\xd9_\x90\xbb\xd4Ljj\x90\x17\x18\xf6\x13\xd1\x17\x8d\xcfN\x12\xe3\xb07\x83mE\x1dG\xa6d\xfe\xbf\xc4\xd0I\xb9\xe3\\\x1cN\x10\xc6r\x90\x03\xb5\xfcFf\x0f\xd7_S\xae\x08;\x9c\xf8\xe5\xa3\xd0\xeca\n\xa7,\x82y.\xe3\x80\xd7\xd4\x87m\xf0`\x0e\xa0c\xb8?\x84+k#\xe9\xa9\xa0e\x847\xa2F\x95\xe4\xba\x90\x02\xac\xf3\xf7\xf5\"\x10s\x910\x9dI\xeb\xe0\xb62\xf7\x02rH\x14\x1cOW\xdcJI\xc6\xc2\xb2\xe5\xdaV\xcdJ\xd920\xbb\xd9B\x06\xfd\xfd\x85{\xa8[\x93\r\x9dY\x84\xber\\\x1c\\=\xe3vofu\xf6DOo\xe9]\xd4\xf2.\x93/M\x94.\xe4\x1f\x19\xdd\xca\x04%!\xc9\x02tp\xcb\xd6\t\xc7\\|\xfdF}\xed\x9f\x9b\xdb\xab)\x14\xd8\xcd\xbe\n\x9c\x1c\x7f\xc3v\x06\x1f\n6z\xeb\x8d\x1b\x93M\x8e7\x1el\xab\xb67r\x8c\xd2\x9a\xb5A$L\xe9\xcf(\x05Q~3\x89\xb7)\xeeB\xc0r\x9c\xad\x04M\xe9\xaeh\x13\x9f\x0b>i\xdaE1\xaaQx]\xac\x0e\x1fE\x89\xf7\xf1\x8ec\x0cqlY\xfbCP\x93v/\xc6\xe6+\xb5m\x02q\x11\xe5\xb4\x8e\xaf\x96\x10\xfe\x86\xa4\x0c\x9eQQ\x1b8uBID\xc32_\xc0\xab\xca\xa8Q\xd1\xa5R\xc5\xdans\xf4i\x84Jd\xc9_\x15\x9e\xf9\xd5\xac_\xb7\xba\xce\xc3\xb0\xbe\xec\x83\xc5\"\xcb-\x8b\x1a\xb7\xcc\x7fPK\x03\x04\x14\0\0\0\x08\0\xd3\xa8d>H>X{|\0\0\0\xb7\0\0\0\x10\0\0\0Munkey/Ah.plugin\xb3\xb1\xaf\xc8\xcdQ(K-*\xce\xcc\xcf\xb3U2\xd43P\xb2\xb7\xe3\xe5\xb2\t\xc8)M\xcf\xcc\x03\xb28m<\xf3\xd2\xf2\x8br\x13K\x80\n@|N\x1b\xbf\xc4\xdcT;\xc7\x0c\x1b}0\x03,\xe4XZ\x92\x91_d\xe7[\x9a\x97\x9dZi\xa3\x0f\xe5\x82\xa5\xc2 f\xdb\x19\xe8\x99\xda\xe8\xc38 s\xf5\xd1\x0c\xb6\tHL\xceNLO\x85\x9a\xa2\xe7\x98\xa1\xe7\x9b\x98\x99g\xa3\x0f\x13\x07:K\x1f\xea.\0PK\x01\x02\x14\0\n\0\0\0\0\0\xb2\x866>\0\0\0\0\0\0\0\0\0\0\0\0\x07\0\0\0\0\0\0\0\0\0\x10\0\0\0\0\0\0\0Munkey/PK\x01\x02\x14\0\n\0\0\0\0\0\xfc{\\>\0\0\0\0\0\0\0\0\0\0\0\0\n\0\0\0\0\0\0\0\0\0\x10\0\0\0%\0\0\0Munkey/Ah/PK\x01\x02\x14\0\x14\0\0\0\x08\0\xfcjb>\x1fM\xcfn*\x04\0\0-\x0c\0\0\x12\0\0\0\0\0\0\0\x01\0 \0\0\0M\0\0\0Munkey/Ah/Main.luaPK\x01\x02\x14\0\x14\0\0\0\x08\0\xd3\xa8d>H>X{|\0\0\0\xb7\0\0\0\x10\0\0\0\0\0\0\0\x01\0 \0\0\0\xa7\x04\0\0Munkey/Ah.pluginPK\x05\x06\0\0\0\0\x04\0\x04\0\xeb\0\0\0Q\x05\0\0\0\0"[..]);

        installer.install(&bytes).unwrap();

        // installer.delete().unwrap();

        fs::remove_dir_all(test_dir).expect("Error while running test teardown");
    }
}
